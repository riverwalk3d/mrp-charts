<!DOCTYPE html>
<html>
<head>
    <!-- MRP Chart Component v2.0 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        body { 
            margin:0; 
            padding:24px; 
            background:#ffffff; 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            height: 100vh;
            overflow: hidden;
            color: #333;
        }
        .container { 
            text-align:center; 
            width: 210px; /* Reduced to 75% of 280px */
            margin:0 auto; 
            background: #ffffff;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.25); /* Darker shadow */
        }
        #chartContainer {
            width: 130px;
            height: 130px;
            margin: 0 auto 16px auto;
            position: relative;
        }
        #chart { 
            width: 130px !important;
            height: 130px !important;
        }
        .spool-info { 
            font-size: 14px; 
            font-weight: 600;
            color: #333; 
            margin-bottom: 8px;
            letter-spacing: -0.01em;
        }
        .percentage { 
            font-size: 28px; 
            font-weight: 700; 
            color: #333; 
            margin-bottom: 4px;
            letter-spacing: -0.02em;
        }
        .remaining-text {
            font-size: 13px;
            color: #666;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .weight-info {
            font-size: 12px;
            color: #888;
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid #f0f0f0;
        }
        .version {
            position: absolute;
            bottom: 5px;
            right: 5px;
            font-size: 10px;
            color: #ccc;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="spool-info" id="spoolInfo">Loading...</div>
        <div id="chartContainer">
            <canvas id="chart"></canvas>
        </div>
        <div class="percentage" id="percentText">---%</div>
        <div class="remaining-text">REMAINING</div>
        <div class="weight-info" id="weightInfo"></div>
    </div>
    <div class="version">v2.0</div>
    
    <script>
        window.addEventListener('load', function() {
            const urlParams = new URLSearchParams(window.location.search);
            const percentage = parseFloat(urlParams.get('percent')) || 0;
            const spoolId = urlParams.get('spool') || 'Unknown';
            const brand = urlParams.get('brand') || '';
            const weight = urlParams.get('weight') || '';
            const hexColor = urlParams.get('color') || ''; // New parameter for hex color
            
            const remaining = 100 - percentage;
            
            // Update displays
            document.getElementById('spoolInfo').textContent = spoolId + (brand ? ' â€¢ ' + brand : '');
            document.getElementById('percentText').textContent = percentage.toFixed(1) + '%';
            
            if (weight) {
                document.getElementById('weightInfo').textContent = weight + 'g remaining';
            }
            
            // Determine fill color
            let fillColor = '#000000'; // Default black
            
            if (hexColor && hexColor.trim() !== '') {
                // Use provided hex color (ensure it starts with #)
                fillColor = hexColor.startsWith('#') ? hexColor : '#' + hexColor;
            }
            
            const ctx = document.getElementById('chart').getContext('2d');
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    datasets: [{
                        data: [percentage, remaining],
                        backgroundColor: [fillColor, '#F3F4F6'],
                        borderWidth: 0,
                        cutout: '20%' // Reduced from 75% to make doughnut much thicker
                    }]
                },
                options: {
                    responsive: false,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: { enabled: false }
                    },
                    animation: { duration: 0 }
                }
            });
        });
    </script>
</body>
</html>
